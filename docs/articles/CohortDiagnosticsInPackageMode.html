<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cohort Diagnostics in an OHDSI Package mode • CohortDiagnostics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Cohort Diagnostics in an OHDSI Package mode">
<meta property="og:description" content="CohortDiagnostics">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CohortDiagnostics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CohortDiagnosticsInPackageMode.html">Cohort Diagnostics in an OHDSI Package mode</a>
    </li>
    <li>
      <a href="../articles/CohortDiagnosticsUsingWebApi.html">Running cohort diagnostics using WebAPI</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/CohortDiagnostics/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="CohortDiagnosticsInPackageMode_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cohort Diagnostics in an OHDSI Package mode</h1>
                        <h4 class="author">Gowtham A. Rao</h4>
            
            <h4 class="date">2021-04-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/CohortDiagnostics/blob/master/vignettes/CohortDiagnosticsInPackageMode.Rmd"><code>vignettes/CohortDiagnosticsInPackageMode.Rmd</code></a></small>
      <div class="hidden name"><code>CohortDiagnosticsInPackageMode.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette describes how to create a self contained shareable study package that can execute cohort diagnostics on a given set of cohort definitions.</p>
<p>In this vignette, you will learn how to - use the Cohort Diagnostics template package - Hydrate the template package with the cohort definitions you want to diagnose. - Execute the diagnostics on one or more data sources. - Review the result set using the Diagnostics Explorer R shiny app of Cohort Diagnostics - (optional) Submit the results of your cohort diagnostics to the OHDSI Phenotype library.</p>
<div id="assumptions" class="section level2">
<h2 class="hasAnchor">
<a href="#assumptions" class="anchor"></a>Assumptions:</h2>
<ul>
<li>You have a set of valid cohort definition sql files (in parameterized OHDSI Sql format) that you want to run diagnostics on, or you are able to export cohort definitions that you want to diagnose from Atlas by using the export tab within cohort definition module of Atlas or using ROhdsiWebApi as described <a href="https://ohdsi.github.io/ROhdsiWebApi/articles/InsertCohortDefinitionsIntoPackage.html">here</a>.</li>
<li>You have access to person level data in OMOP CDM V5.x + format on a database, are able to execute and instantiate cohorts in cohort tables (i.e. you have access to a schema in the same database with Create, Read, Update, Delete privileges.)</li>
</ul>
</div>
<div id="identifying-cohorts" class="section level2">
<h2 class="hasAnchor">
<a href="#identifying-cohorts" class="anchor"></a>identifying cohorts:</h2>
<p>The cohorts to diagnose should have two attributes to them.</p>
<ul>
<li>
<strong>id</strong>: A unique integer identifier for the cohort you are diagnosing. If you created your cohort using atlas, this is your atlas id.</li>
<li>
<strong>cohortName</strong>: The unique string name for your cohort. Usually it is the same as your Atlas cohort name, but it can be any name you wish to identify your cohort. This name will be used to display your cohort in the Diagnostics Explorer shiny app.</li>
</ul>
<p>Example:</p>
<table class="table">
<colgroup>
<col width="44%">
<col width="55%">
</colgroup>
<thead><tr class="header">
<th align="right">id</th>
<th align="left">cohortName</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">17561</td>
<td align="left">[PL 4112853001] Malignant tumor of breast referent concept incident cohort: First occurrence of referent concept + descendants with &gt;=365d prior observation</td>
</tr></tbody>
</table>
</div>
<div id="option-a-using-hydra-and-rohdsiwebapi" class="section level2">
<h2 class="hasAnchor">
<a href="#option-a-using-hydra-and-rohdsiwebapi" class="anchor"></a>option A: Using Hydra and ROhdsiWebApi</h2>
<p>The skeleton cohort diagnostics study package is <a href="https://github.com/OHDSI/SkeletonCohortDiagnostics">here</a>. A skeleton package is a special package that is designed to be used with <a href="https://github.com/OHDSI/Hydra">Hydra</a>. The input for Hydra is study a specifications file (in json format). Example is <a href="https://github.com/OHDSI/Hydra/blob/master/extras/ExampleCohortDiagnosticsSpecs.json">here</a>.</p>
<p>We can create this json using the shiny app ‘Diagnostics Editor’ available here(XXXXXX). A version is deployed at data.ohdsi.org/XXXXXXXXXXXXX. The user interface of this shiny app allows you to make selections that are then used to create the specifications json file. The application also allows you to hydrate a package using Hydra, and download a .zip that contains your study package.</p>
<p>Alternatively, you can take the example specification-json file and edit it in notepad. You can then use to create the study package as follows</p>
<p>XXXXXXXXXx</p>
<p>Now you may install your package and execute the study.</p>
</div>
<div id="option-b-using-only-rohdsiwebapi" class="section level2">
<h2 class="hasAnchor">
<a href="#option-b-using-only-rohdsiwebapi" class="anchor"></a>option B: using only ROhdsiWebApi</h2>
<p>Start with the skeleton cohort diagnostics study package is <a href="https://github.com/OHDSI/SkeletonCohortDiagnostics">here</a>. See Vignette from ROhdsiWebApi <a href="https://ohdsi.github.io/ROhdsiWebApi/articles/InsertCohortDefinitionsIntoPackage.html">here</a>. Create the ‘CohortsToCreate.csv’ file by extracting the cohorts from your atlas as described. Now, open your study package and run</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/insertCohortDefinitionSetInPackage.html">insertCohortDefinitionSetInPackage</a></span><span class="op">(</span>fileName <span class="op">=</span> <span class="st">"CohortsToCreate.csv"</span>,
                                                 baseUrl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"baseUrl"</span><span class="op">)</span>,
                                                 insertTableSql <span class="op">=</span> <span class="cn">TRUE</span>,
                                                 insertCohortCreationR <span class="op">=</span> <span class="cn">TRUE</span>,
                                                 generateStats <span class="op">=</span> <span class="cn">TRUE</span>,
                                                 packageName <span class="op">=</span> <span class="st">"SkeletonCohortDiagnosticsStudy"</span><span class="op">)</span></code></pre></div>
<p>This will create the relevant files in your package.</p>
<p>The next step is to rename the generic name of the package ‘SkeletonCohortDiagnosticsStudy’ into something more meaningful to identify your study such as ‘CandidateHypertensionCohorts’. One way of doing this is to use Notepad ++ find and replace ‘SkeletonCohortDiagnosticsStudy’ with a name for your study. Also change the ‘SkeletonCohortDiagnosticsStudy.Rproj’ to your study name ‘CandidateHypertensionCohorts.Rproj’.</p>
<p>Now you may install your package and execute the study.</p>
</div>
<div id="option-c-manual-advanced-users" class="section level2">
<h2 class="hasAnchor">
<a href="#option-c-manual-advanced-users" class="anchor"></a>Option C: Manual (advanced users)</h2>
<p>Start with the skeleton cohort diagnostics study package is <a href="https://github.com/OHDSI/SkeletonCohortDiagnostics">here</a>. Manually populate the <a href="https://github.com/OHDSI/SkeletonCohortDiagnostics/blob/main/inst/settings/CohortsToCreate.csv">CohortToCreate.csv file</a> with the atlasId, cohortId and cohortName. In most cases atlasId = cohortId and should be an integer. cohortName is a meaningful name to identify your cohorts.</p>
<p>Next - create a new folder called ‘sql’ in the ‘inst’ folder and put all your SQLs. The sql file should be named to match the cohortId e.g. if the cohortId is 1232 then the sql file should be 1232.sql. Optionally, you can also add the cohort json in another folder in ‘inst’ folder of your package called ‘cohorts’. The names of the cohorts should be the same as the sql files, except they will end with .json instead of .sql.</p>
<p>If your cohorts have inclusion-rules, then you will have to create a file called ‘InclusionRules.csv’ and populate it as shown in this example:</p>
<table class="table">
<thead><tr class="header">
<th>cohortName</th>
<th>ruleSequence</th>
<th>ruleName</th>
<th>cohortId</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>14907</td>
<td>0</td>
<td>With no history of gastrointestinal hemorrhage</td>
<td>14907</td>
</tr>
<tr class="even">
<td>18349</td>
<td>0</td>
<td>Gender is male</td>
<td>18349</td>
</tr>
<tr class="odd">
<td>18350</td>
<td>0</td>
<td>Gender is male</td>
<td>18350</td>
</tr>
<tr class="even">
<td>18350</td>
<td>1</td>
<td>Metabolic disease at any time</td>
<td>18350</td>
</tr>
<tr class="odd">
<td>18352</td>
<td>0</td>
<td>With gastrointestinal hemorrhage at some point</td>
<td>18352</td>
</tr>
</tbody>
</table>
<p>Now you may install your package and execute the study.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gowtham Rao, Martijn Schuemie, Patrick Ryan, James Weaver, Jamie Gilbert.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
